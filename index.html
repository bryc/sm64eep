<style>
    body {
        background:#bba;
        padding-top:56px;
    }
    body, table {
        font:14px PT Sans, Segoe UI, Verdana, sans-serif;
        color:#999;
    }
    #byc-table, div#p, div.menu {
        background:#fff;
        margin: auto;
        width:768px;
        min-width:768px;
        margin-bottom:32px;
    }
    #byc-table th, div.menu {
        font-size: 16px;
        padding: 8px 6px;
    }
    #byc-table {
        border-collapse: collapse;
    }
    #byc-table td, div#p div {
       
        color:#555;
        padding: 8px 8px;
        border-bottom: 1px solid #eaeaea;
        border-right:1px solid #eaeaea;
    }
    #col th:last-child,
    #byc-table td:last-child
    {border-right:none}
    .m {  font-family: Liberation Mono, Consolas, monospace; } 
    #col { 
        text-align: left;
        border-top:1px solid #666;
    }
    #col th {
        border-right:1px solid #555;
    font-size:14px;
    background:#444;
        font-weight: normal;
    }
    #byc-table tbody tr:hover td {
        background:#f5f5f5;
        color: #000;
    }
    table {
        width: 100%;
    }
    th { background:#222;color:#fff; }
    th.med {
        width: 80px;
    }
    th.small {
        width: 40px;
    }
    td.flags {
        white-space:pre
    }
    div.menu
    {
    text-align:center;
    position:fixed;
    left:0px;top:0px;
    width:100%;
    z-index:5;background:#fff;
    }
a:link, a:visited { font-style:italic;text-decoration:underline; color:#aaa; }
a:hover{ text-decoration:none;color:#bbb}
code{color:#777;}

:target {
    display: block;    
    position: relative;     
    top: -60px;
    visibility: hidden;
}
p{       padding: 8px 8px;margin:0px}
h1{color:#000;margin:0;padding:0}

div.pg
{       margin: auto;
        padding-top:16px;
        padding-bottom:16px;
        width:800px;
        background:#ccb;
}

div#fk
{   position:fixed;top:0;left:0;z-index:100;
        font-size: 16px;
        padding: 8px 6px;
}
</style>
<div id=fk>
<b>sm64eep_doc</b> v01 - 2015 bryc
</div>


<div class=menu></div>

<div pn="Overview" style="display:none" class=pg>

<div id=p>

<p>
<b>Super Mario 64</b> uses a 512-byte EEPROM chip in the cartridge.
The EEPROM is divided into four sections for game save data, with an additional section for global data.
Each section contains a duplicate backup copy in case of data corruption. 
</p>

<p>
    All versions of Super Mario 64 follow this memory layout, with PAL having an additional field in global data for the selected language.
</p>


</div>

<table id="byc-table">
    <thead>
        <tr>
            <th colspan="4">EEPROM structure (512 bytes)</th>
        </tr>
        <tr id="col">
            <th class="med">Start offset</th>
            <th class="med">End offset</th>
            <th class="small">Size</th>
            <th>Short description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="m">0x0000</td>
            <td class="m">0x0037</td>
            <td>56</td>
          <td>Game data, [Mario A]</td>
        </tr>
        <tr>
            <td class="m">0x0038</td>
            <td class="m">0x006F</td>
            <td>56</td>
            <td>Game data, [Mario A – Backup]</td>
        </tr>
        <tr>
            <td class="m">0x0070</td>
            <td class="m">0x00A7</td>
            <td>56</td>
            <td>Game data, [Mario B]</td>
        </tr>
        <tr>
            <td class="m">0x00A8</td>
            <td class="m">0x00DF</td>
            <td>56</td>
            <td>Game data, [Mario B – Backup]</td>
        </tr>
        <tr>
            <td class="m">0x00E0</td>
            <td class="m">0x0117</td>
            <td>56</td>
            <td>Game data, [Mario C]</td>
        </tr>
        <tr>
            <td class="m">0x0118</td>
            <td class="m">0x014F</td>
            <td>56</td>
            <td>Game data, [Mario C – Backup]</td>
        </tr>
        <tr>
            <td class="m">0x0150</td>
            <td class="m">0x0187</td>
            <td>56</td>
            <td>Game data, [Mario D]</td>
        </tr>
        <tr>
            <td class="m">0x0188</td>
            <td class="m">0x01BF</td>
            <td>56</td>
            <td>Game data, [Mario D – Backup]</td>
        </tr>
        <tr>
            <td class="m">0x01C0</td>
            <td class="m">0x01DF</td>
            <td>32</td>
          <td>Global data</td>
        </tr>
        <tr>
            <td class="m">0x01E0</td>
            <td class="m">0x01FF</td>
            <td>32</td>
            <td>Global data, [Backup]</td>
        </tr>
    </tbody>
</table>

</div>


<div pn="Game data" style="display:none" class=pg>

<table id="byc-table">
    <thead>
        <tr>
            <th colspan=4>Game data, overall structure (56 bytes)</th>
        </tr>
        <tr id=col>
            <th class=med>Start offset</th>
            <th class=med>End offset</th>
            <th class=small>Size</th>
            <th>Short description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="m">0x0000</td>
            <td class="m">0x0007</td>
            <td>8</td>
            <td>Coordinates of Mario's lost cap</td>
        </tr>
        <tr>
            <td class="m">0x0008</td>
            <td class="m">0x0024</td>
            <td>29</td>
            <td>Boolean flags (Level flags and misc flags - stars, cannons and others)</td>
        </tr>
        <tr>
            <td class="m">0x0025</td>
            <td class="m">0x0033</td>
            <td>15</td>
            <td>Coin high scores</td> 
        </tr>
        <tr>
            <td class="m">0x0034</td>
            <td class="m">0x0035</td>
            <td>2</td>
            <td>Magic number ( <code>0x4441, 'DA'</code> )
            </td>
        </tr>
        <tr>
            <td class="m">0x0036</td>
            <td class="m">0x0037</td>
            <td>2</td>
            <td>16-bit checksum</td>
        </tr>
    </tbody>
</table>
<br>

<table id="byc-table">
    <thead>
        <tr><div id=coord></div>
            <th colspan=4>Coordinates of Mario's lost cap</th>
        </tr>
        <tr><td colspan=4>
          <p><b>Note:</b> This coordinate system seems to be a removed feature, besides the Level ID being used in the misc flags.
              When Mario is blown away in Snowman's Land, the coordinates of his hat is saved here, but are never used. Mario's cap is always with
              the snowman in that level.</p>
            </td>
          </tr>
        <tr id=col>
            <th class=small>Offset</th>
            <th class=small>Size</th>
            <th style="width:150px" class=small>Type</th>
            <th>Short description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
          <td class="m">0x00</td>
            <td>1</td>
            <td>8-bit int</td>
            <td>
                <b>Level map ID specifier (Only these values work with flag <code>0x09:0</code> below)</b><br>
              <code>
                0x08: Shifting Sand Land<br>
                0x0C: Snowman's Land<br>
                0x24: Tall, Tall Mountain
              </code>
            </td>
        </tr>
        <tr>
            <td class="m">0x01</td>
            <td>1</td>
            <td>8-bit int</td>
          <td>Unknown (always <code>0x01</code>)</td>
        </tr>
        <tr>
            <td class="m">0x02</td>
            <td>2</td>
            <td>signed 16-bit int</td>
            <td>x coordinate</td>
        </tr>
        <tr>
            <td class="m">0x04</td>
            <td>2</td>
            <td>signed 16-bit int</td>
            <td>y coordinate</td>
        </tr>
        <tr>
            <td class="m">0x06</td>
            <td>2</td>
            <td>signed 16-bit int</td>
            <td>z coordinate</td>
        </tr>
    </tbody>
</table>

<table id="byc-table">
    <thead>
        <tr>
            <th colspan=3>Misc flags</th>
        </tr>
        <tr><td colspan=3>
          <p><b>Note:</b> The misc flag bytes are listed in reverse (0x0B to 0x09), to highlight the order of bits.</p>
          </tr>
        <tr id=col>
            <th style="width:40px" class=small>Offset</th>
            <th style="width:50px" class=small>Bit pos</th>
            <th>Short description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="m">0x0B</td>
            <td>0</td>
            <td>
                File is occupied on main menu, showing star amount<br>
                <em>Generally marks a file as "in use". Can be used to skip intro with 0 stars!</em>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>1</td>
            <td>Wing Cap is activated</td>
        </tr>
        <tr>
            <td></td>
            <td>2</td>
            <td>Metal Cap is activated</td>
        </tr>
        <tr>
            <td></td>
            <td>3</td>
            <td>Vanish Cap is activated</td>
        </tr>
        <tr>
            <td></td>
            <td>4</td>
            <td>Have key - Basement</td>
        </tr>
        <tr>
            <td></td>
            <td>5</td>
            <td>Have key - 2nd Floor</td>
        </tr>
        <tr>
            <td></td>
            <td>6</td>
            <td>Key door is unlocked - Basement</td>
        </tr>
        <tr>
            <td></td>
            <td>7</td>
            <td>Key door is unlocked - 2nd Floor</td>
        </tr>
        <tr>
            <td class="m">0x0A</td>

            <td>0</td>
            <td>
                Portal is moved back (Dire Dire Docks entrance)<br>
                <em>Saved when collecting Star 1: Board Bowser's Sub to allow entry into Bowser in the Fire Sea.</em>
            </td>
        </tr>
        <tr>
            <td></td>
            <td>1</td>
            <td>Castle moat is drained</td>
        </tr>
        <tr>
            <td></td>
            <td>2</td>
            <td>Star door animation seen (1 star, Princess's Secret Slide)</td>
        </tr>
        <tr>
            <td></td>
            <td>3</td>
            <td>Star door animation seen (1 star, Whomp's Fortress)</td>
        </tr>
        <tr>
            <td></td>
            <td>4</td>
            <td>Star door animation seen (3 stars, Cool, Cool Mountain)</td>
        </tr>
        <tr>
            <td></td>
            <td>5</td>
            <td>Star door animation seen (3 stars, Jolly Roger Bay)</td>
        </tr>
        <tr>
            <td></td>
            <td>6</td>
            <td>Star door animation seen (8 stars, Bowser in the Dark World)</td>
        </tr>
        <tr>
            <td></td>
            <td>7</td>
            <td>Star door animation seen (30 stars, Bowser in the Fire Sea)</td>
        </tr>
        <tr>
            <td class="m">0x09</td>

            <td>0</td>
            <td>Lost cap - Mario's cap is lost in: Level ID (Depends on coordinate level ID)</td>
        </tr>
        <tr>
            <td></td>
            <td>1</td>
            <td>Lost cap - Mario's cap is lost in: Shifting Sand Land</td>
        </tr>
        <tr>
            <td></td>
            <td>2</td>
            <td>Lost cap - Mario's cap is lost in: Tall, Tall Mountain</td>
        </tr>
        <tr>
            <td></td>
            <td>3</td>
            <td>Lost cap - Mario's cap is lost in: Snowman's Land</td>
        </tr>
        <tr>
            <td></td>
            <td>4</td>
            <td>Star door animation seen (50 stars, 3rd Floor/Tick Tock Clock)</td>
        </tr>
        <!-- Note: The term 'reserved' is not used here (5,6,7) because reserved refers to potential upgradability.
             SM64 is over a decade old, and there will be no future updates here. It is either unknown or unused. -->
        <tr>
            <td></td>
            <td>5</td>
            <td>unused or unknown</td>
        </tr>
        <tr>
            <td></td>
            <td>6</td>
            <td>unused or unknown</td>
        </tr>
        <tr>
            <td></td>
            <td>7</td>
            <td>unused or unknown</td>
        </tr>
    </tbody>
</table>


<table id="byc-table">
    <thead>        
        <tr>
            <th colspan=4>Level flags</th>
        </tr>
<tr>
        <td colspan=4>
          <p><b>Note:</b><br>
            For saving stars and cannons in levels ("Level flags"), there are 26 bytes that follow the same format.
              Rather than list out the names of each star here, I will describe the general format, and provide a list of each level and its offset.
            </p>
          <p>There are only 120 stars in the game, but the data format allows for up to 182 stars (7*26).
              This is made possible because each level is assigned a byte that can store up to 7 individual stars, but not all levels use them all.
              The last byte does not store any stars normally, however some ROM hacks like Star Road can use it.
          </p>
          <p>
            <code style='padding-left:16px;display:inline-block'>
              Bit 0: Star 1<br>
              Bit 1: Star 2<br>
              Bit 2: Star 3<br>
              Bit 3: Star 4<br>
              Bit 4: Star 5<br>
              Bit 5: Star 6<br>
              Bit 6: Star 7<br>
              Bit 7: Cannon unlocked for <i>previous</i> level
            </code>
          </p>
          <p>
              Strangely, <i>bit 7<i> doesn't affect the level that the byte references like the stars do. Instead it affects the previous level in the list.
              For example, if bit 7 bit is set on the "Whomp's Fortress" byte, the cannon is then activated in Bob-omb Battlefield.
              
              It is possible to activate cannons on levels that originally had no cannon. The cannon object can be added through a ROM hack, 
              however not all levels can have a cannon hacked in. Specifically it is not possible in The Secret Aquarium, and anywhere inside the interior castle or the Bowser boss battle maps.
              I have no clue about the "The End" screen with a cake painting.
              I do know that a working cannon can be activated on the outside of the castle (courtyard included).
          </p>
          </td>
        </tr>
        <tr id=col>
            <th style="width:80px" class=small>Offset</th>
            <th>Short description</th>
        </tr>
    </thead>
    <tbody>

        <tr>
            <td class="m">0x08</td>
            <td>Castle</td>
        </tr>
        <tr>
            <td class="m">0x0C</td>
            <td>1 Bob-omb Battlefield</td>
        </tr>
        <tr>
            <td class="m">0x0D</td>
            <td>2 Whomp's Fortress</td>
        </tr>
        <tr>
            <td class="m">0x0E</td>
            <td>3 Jolly Roger Bay</td>
        </tr>
        <tr>
            <td class="m">0x0F</td>
            <td>4 Cool, Cool Mountain</td>
        </tr>
        <tr>
            <td class="m">0x10</td>
            <td>5 Big Boo's Haunt</td>
        </tr>
        <tr>
            <td class="m">0x11</td>
            <td>6 Hazy Maze Cave</td>
        </tr>
        <tr>
            <td class="m">0x12</td>
            <td>7 Lethal Lava Land</td>
        </tr>
        <tr>
            <td class="m">0x13</td>
            <td>8 Shifting Sand Land</td>
        </tr>
        <tr>
            <td class="m">0x14</td>
            <td>9 Dire, Dire Docks</td>
        </tr>
        <tr>
            <td class="m">0x15</td>
            <td>10 Snowman's Land</td>
        </tr>
        <tr>
            <td class="m">0x16</td>
            <td>11 Wet-Dry World</td>
        </tr>
        <tr>
            <td class="m">0x17</td>
            <td>12 Tall, Tall Mountain</td>
        </tr>
        <tr>
            <td class="m">0x18</td>
            <td>13 Tiny-Huge Island</td>
        </tr>
        <tr>
            <td class="m">0x19</td>
            <td>14 Tick Tock Clock</td>
        </tr>
        <tr>
            <td class="m">0x1A</td>
            <td>15 Rainbow Ride</td>
        </tr>
        <tr>
            <td class="m">0x1B</td>
            <td>Bowser in the Dark World</td>
        </tr>
        <tr>
            <td class="m">0x1C</td>
            <td>Bowser in the Fire Sea</td>
        </tr>
        <tr>
            <td class="m">0x1D</td>
            <td>Bowser in the Sky</td>
        </tr>
        <tr>
            <td class="m">0x1E</td>
            <td>The Princess's Secret Slide</td>
        </tr>
        <tr>
            <td class="m">0x1F</td>
            <td>Cavern of the Metal Cap</td>
        </tr>
        <tr>
            <td class="m">0x20</td>
            <td>Tower of the Wing Cap</td>
        </tr>
        <tr>
            <td class="m">0x21</td>
            <td>Vanish Cap Under the Moat</td>
        </tr>
        <tr>
            <td class="m">0x22</td>
            <td>Wing Mario Over the Rainbow</td>
        </tr>
        <tr>
            <td class="m">0x23</td>
            <td>The Secret Aquarium</td>
        </tr>
        <tr>
            <td class="m">0x24</td>
            <td><b>Unused level</b>: "<i>The End</i>" screen (Cake picture after credits)</td>
        </tr>
    </tbody>
</table>

<table id="byc-table">
    <thead>
        <tr>
            <th colspan=4>Level high scores (Coins)</th>
        </tr>
      <tr><td colspan=4>
        <p>
          The high scores are simply unsigned 8-bit integers (0-255).
          
        </p>
        
      </td></tr>
        <tr id=col>
            <th style="width:80px" class=small>Offset</th>
            <th class=small>Size</th>
            <th style="width:150px" class=small>Type</th>
            <th>Short description</th>
        </tr>
    </thead>
    <tbody>
    <tr><td class="m">0x25</td><td>1</td><td>8-bit int</td><td>Bob-omb Battlefield</td></tr>
    <tr><td class="m">0x26</td><td>1</td><td>8-bit int</td><td>Whomp's Fortress</td></tr>
    <tr><td class="m">0x27</td><td>1</td><td>8-bit int</td><td>Jolly Roger Bay</td></tr>
    <tr><td class="m">0x28</td><td>1</td><td>8-bit int</td><td>Cool, Cool Mountain</td></tr>
    <tr><td class="m">0x29</td><td>1</td><td>8-bit int</td><td>Big Boo's Haunt</td></tr>
    <tr><td class="m">0x2A</td><td>1</td><td>8-bit int</td><td>Hazy Maze Cave</td></tr>
    <tr><td class="m">0x2B</td><td>1</td><td>8-bit int</td><td>Lethal Lava Land</td></tr>
    <tr><td class="m">0x2C</td><td>1</td><td>8-bit int</td><td>Shifting Sand Land</td></tr>
    <tr><td class="m">0x2D</td><td>1</td><td>8-bit int</td><td>Dire, Dire Docks</td></tr>
    <tr><td class="m">0x2E</td><td>1</td><td>8-bit int</td><td>Snowman's Land</td></tr>
    <tr><td class="m">0x2F</td><td>1</td><td>8-bit int</td><td>Wet-Dry World</td></tr>
    <tr><td class="m">0x30</td><td>1</td><td>8-bit int</td><td>Tall, Tall Mountain</td></tr>
    <tr><td class="m">0x31</td><td>1</td><td>8-bit int</td><td>Tiny-Huge Island</td></tr>
    <tr><td class="m">0x32</td><td>1</td><td>8-bit int</td><td>Tick Tock Clock</td></tr>
    <tr><td class="m">0x33</td><td>1</td><td>8-bit int</td><td>Rainbow Ride</td></tr>

    </tbody>
    </table>


</div>


<div pn="Global data" style="display:none" class=pg>

<table id="byc-table">
    <thead>
        <tr>
            <th id=test colspan=4>Global data</a> structure (32 bytes)</th>
        </tr>
        <tr id=col>
            <th class=med>Start offset</th>
            <th class=med>End offset</th>
            <th class=small>Size</th>
            <th>Short description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td class="m">0x0000</td>
            <td class="m">0x000F</td>
            <td>16</td>
            <td>Unknown XOR data (unused, somehow related to level highscores)</td>
        </tr>
        <tr>
            <td>0x0010</td>
            <td>0x0011</td>
            <td>2</td>
            <td>
              <b>Sound setting</b><br>
              <code>
                0x00: Stereo<br>
                0x01: Mono<br>
                0x02: Headset
              </code>
            </td>
        </tr>
        <tr>
            <td class="m">0x0012</td>
            <td class="m">0x0013</td>
            <td>2</td>
            <td>
              <b>Language setting (PAL version only)</b><br>
              <code>
              0x00: English<br>
              0x01: French<br>
              0x02: German
              </code>
              </td>
        </tr>
        <tr>
            <td class="m">0x0014</td>
            <td class="m">0x001B</td>
            <td>8</td>
            <td>unknown or unused</td>
        </tr>
        <tr>
            <td class="m">0x001C</td>
            <td class="m">0x001D</td>
            <td>2</td>
          <td>Magic number ( <code>0x4849, 'HI'</code> )</td>
        </tr>
        <tr>
            <td class="m">0x001E</td>
            <td class="m">0x001F</td>
            <td>2</td>
            <td>16-bit checksum</td>
        </tr>
    </tbody>
</table>

</div>

<script>
window.onload = function()
{
    var t = document.querySelectorAll("div.pg");
    
    for(var i = 0; i < t.length; i++)
    {
        var L = document.querySelector("div.menu");
        L.innerHTML += "<a href='?pg="+i+"'>"+ t[i].getAttribute('pn')+"</a>";
        if(i < t.length-1){L.innerHTML += " | "}
    }
    
    var nav = window.location.search.substr(1);
    var nv2 = nav.split("=");
    if(nv2[0]=="pg")
    {
        document.querySelectorAll('div.pg')[nv2[1]].style.cssText="";
    }
    else
    {
        document.querySelectorAll('div.pg')[0].style.cssText="";
    }
}
</script>
